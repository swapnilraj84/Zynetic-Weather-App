"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.allow_action = allow_action;
exports.createAnonymousRemoteUser = createAnonymousRemoteUser;
exports.createRemoteUser = createRemoteUser;
exports.expireReasons = exports.defaultUserRateLimiting = exports.defaultSecurity = void 0;
exports.getApiToken = getApiToken;
exports.getDefaultPlugins = getDefaultPlugins;
exports.getMiddlewareCredentials = getMiddlewareCredentials;
exports.getSecurity = getSecurity;
exports.handleSpecialUnpublish = handleSpecialUnpublish;
exports.isAESLegacy = isAESLegacy;
exports.isAuthHeaderValid = isAuthHeaderValid;
exports.parseAESCredentials = parseAESCredentials;
exports.parseAuthTokenHeader = parseAuthTokenHeader;
exports.parseBasicPayload = parseBasicPayload;
exports.validatePassword = validatePassword;
exports.verifyJWTPayload = verifyJWTPayload;
var _debug = _interopRequireDefault(require("debug"));
var _lodash = _interopRequireDefault(require("lodash"));
var _utils = require("@verdaccio/utils");
var _constants = require("./constants");
var _cryptoUtils = require("./crypto-utils");
var _logger = require("./logger");
var _utils2 = require("./utils");
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const debug = (0, _debug.default)('verdaccio');
function validatePassword(password,
// pragma: allowlist secret
minLength = _constants.DEFAULT_MIN_LIMIT_PASSWORD) {
  return typeof password === 'string' && password.length >= minLength;
}

/**
 * Create a RemoteUser object
 * @return {Object} { name: xx, pluginGroups: [], real_groups: [] }
 */
function createRemoteUser(name, pluginGroups) {
  const isGroupValid = Array.isArray(pluginGroups);
  const groups = Array.from(new Set((isGroupValid ? pluginGroups : []).concat([_constants.ROLES.$ALL, _constants.ROLES.$AUTH, _constants.ROLES.DEPRECATED_ALL, _constants.ROLES.DEPRECATED_AUTH, _constants.ROLES.ALL])));
  return {
    name,
    groups,
    real_groups: pluginGroups
  };
}

/**
 * Builds an anonymous remote user in case none is logged in.
 * @return {Object} { name: xx, groups: [], real_groups: [] }
 */
function createAnonymousRemoteUser() {
  return {
    name: undefined,
    // groups without '$' are going to be deprecated eventually
    groups: [_constants.ROLES.$ALL, _constants.ROLES.$ANONYMOUS, _constants.ROLES.DEPRECATED_ALL, _constants.ROLES.DEPRECATED_ANONYMOUS],
    real_groups: []
  };
}
function allow_action(action) {
  return function (user, pkg, callback) {
    debug('[auth/allow_action]: user: %o', user === null || user === void 0 ? void 0 : user.name);
    const {
      name,
      groups
    } = user;
    const groupAccess = pkg[action];
    const hasPermission = groupAccess.some(group => name === group || groups.includes(group));
    debug('[auth/allow_action]: hasPermission? %o} for user: %o', hasPermission, user === null || user === void 0 ? void 0 : user.name);
    if (hasPermission) {
      _logger.logger.info({
        remote: user.name
      }, `auth/allow_action: access granted to: @{user}`);
      return callback(null, true);
    }
    if (name) {
      callback(_utils2.ErrorCode.getForbidden(`user ${name} is not allowed to ${action} package ${pkg.name}`));
    } else {
      callback(_utils2.ErrorCode.getUnauthorized(`authorization required to ${action} package ${pkg.name}`));
    }
  };
}

/**
 *
 */
function handleSpecialUnpublish() {
  return function (user, pkg, callback) {
    const action = 'unpublish';
    // verify whether the unpublish prop has been defined
    const isUnpublishMissing = _lodash.default.isNil(pkg[action]);
    const hasGroups = isUnpublishMissing ? false : pkg[action].length > 0;
    debug('fallback unpublish for @{name} has groups: %o for %o', hasGroups, user === null || user === void 0 ? void 0 : user.name);
    if (isUnpublishMissing || hasGroups === false) {
      return callback(null, undefined);
    }
    debug('allow_action for %o for %o has groups: %o for %o', action, user === null || user === void 0 ? void 0 : user.name, hasGroups, user);
    return allow_action(action)(user, pkg, callback);
  };
}
function getDefaultPlugins(logger) {
  return {
    authenticate(_user, _password, cb) {
      // pragma: allowlist secret
      cb(_utils2.ErrorCode.getForbidden(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
    },
    add_user(_user, _password, cb) {
      // pragma: allowlist secret
      return cb(_utils2.ErrorCode.getConflict(_constants.API_ERROR.BAD_USERNAME_PASSWORD));
    },
    // FIXME: allow_action and allow_publish should be in the @verdaccio/types
    // @ts-ignore
    allow_access: allow_action('access', logger),
    // @ts-ignore
    allow_publish: allow_action('publish', logger),
    allow_unpublish: handleSpecialUnpublish()
  };
}
const defaultWebTokenOptions = {
  sign: {
    // The expiration token for the website is 1 hour
    expiresIn: _constants.TIME_EXPIRATION_1H
  },
  verify: {}
};
const defaultApiTokenConf = {
  legacy: true
};

// we limit max 1000 request per 15 minutes on user endpoints
const defaultUserRateLimiting = {
  windowMs: 15 * 60 * 1000,
  // 15 minutes
  max: 1000
};
exports.defaultUserRateLimiting = defaultUserRateLimiting;
const defaultSecurity = {
  web: defaultWebTokenOptions,
  api: defaultApiTokenConf
};
exports.defaultSecurity = defaultSecurity;
function getSecurity(config) {
  if (_lodash.default.isNil(config.security) === false) {
    return _lodash.default.merge(defaultSecurity, config.security);
  }
  return defaultSecurity;
}
function isAESLegacy(security) {
  const {
    legacy,
    jwt
  } = security.api;
  return _lodash.default.isNil(legacy) === false && _lodash.default.isNil(jwt) && legacy === true;
}
async function getApiToken(auth, config, remoteUser, aesPassword) {
  const security = getSecurity(config);
  if (isAESLegacy(security)) {
    // fallback all goes to AES encryption
    return await new Promise(resolve => {
      resolve(auth.aesEncrypt((0, _utils.buildUserBuffer)(remoteUser.name, aesPassword)).toString('base64'));
    });
  }
  // i am wiling to use here _.isNil but flow does not like it yet.
  const {
    jwt
  } = security.api;
  if (jwt && jwt.sign) {
    return await auth.jwtEncrypt(remoteUser, jwt.sign);
  }
  return await new Promise(resolve => {
    resolve(auth.aesEncrypt((0, _utils.buildUserBuffer)(remoteUser.name, aesPassword)).toString('base64'));
  });
}
function parseAuthTokenHeader(authorizationHeader) {
  const parts = authorizationHeader.split(' ');
  const [scheme, token] = parts;
  return {
    scheme,
    token
  };
}
function parseBasicPayload(credentials) {
  const index = credentials.indexOf(':');
  if (index < 0) {
    return;
  }
  const user = credentials.slice(0, index);
  const password = credentials.slice(index + 1);
  return {
    user,
    password
  };
}
function parseAESCredentials(authorizationHeader, secret) {
  const {
    scheme,
    token
  } = parseAuthTokenHeader(authorizationHeader);

  // basic is deprecated and should not be enforced
  if (scheme.toUpperCase() === _constants.TOKEN_BASIC.toUpperCase()) {
    const credentials = (0, _utils2.convertPayloadToBase64)(token).toString();
    return credentials;
  } else if (scheme.toUpperCase() === _constants.TOKEN_BEARER.toUpperCase()) {
    const tokenAsBuffer = (0, _utils2.convertPayloadToBase64)(token);
    const credentials = (0, _cryptoUtils.aesDecrypt)(tokenAsBuffer, secret).toString('utf8');
    return credentials;
  }
}
const expireReasons = ['JsonWebTokenError', 'TokenExpiredError'];
exports.expireReasons = expireReasons;
function verifyJWTPayload(token, secret) {
  try {
    const payload = (0, _cryptoUtils.verifyPayload)(token, secret);
    return payload;
  } catch (error) {
    // #168 this check should be removed as soon AES encrypt is removed.
    if (expireReasons.includes(error.name)) {
      // it might be possible the jwt configuration is enabled and
      // old tokens fails still remains in usage, thus
      // we return an anonymous user to force log in.
      return createAnonymousRemoteUser();
    }
    throw _utils2.ErrorCode.getCode(_constants.HTTP_STATUS.UNAUTHORIZED, error.message);
  }
}
function isAuthHeaderValid(authorization) {
  return authorization.split(' ').length === 2;
}
function getMiddlewareCredentials(security, secret, authorizationHeader) {
  if (isAESLegacy(security)) {
    const credentials = parseAESCredentials(authorizationHeader, secret);
    if (!credentials) {
      return;
    }
    const parsedCredentials = parseBasicPayload(credentials);
    if (!parsedCredentials) {
      return;
    }
    return parsedCredentials;
  }
  const {
    scheme,
    token
  } = parseAuthTokenHeader(authorizationHeader);
  if (_lodash.default.isString(token) && scheme.toUpperCase() === _constants.TOKEN_BEARER.toUpperCase()) {
    return verifyJWTPayload(token, secret);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZWJ1ZyIsImJ1aWxkRGVidWciLCJ2YWxpZGF0ZVBhc3N3b3JkIiwicGFzc3dvcmQiLCJtaW5MZW5ndGgiLCJERUZBVUxUX01JTl9MSU1JVF9QQVNTV09SRCIsImxlbmd0aCIsImNyZWF0ZVJlbW90ZVVzZXIiLCJuYW1lIiwicGx1Z2luR3JvdXBzIiwiaXNHcm91cFZhbGlkIiwiQXJyYXkiLCJpc0FycmF5IiwiZ3JvdXBzIiwiZnJvbSIsIlNldCIsImNvbmNhdCIsIlJPTEVTIiwiJEFMTCIsIiRBVVRIIiwiREVQUkVDQVRFRF9BTEwiLCJERVBSRUNBVEVEX0FVVEgiLCJBTEwiLCJyZWFsX2dyb3VwcyIsImNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIiLCJ1bmRlZmluZWQiLCIkQU5PTllNT1VTIiwiREVQUkVDQVRFRF9BTk9OWU1PVVMiLCJhbGxvd19hY3Rpb24iLCJhY3Rpb24iLCJ1c2VyIiwicGtnIiwiY2FsbGJhY2siLCJncm91cEFjY2VzcyIsImhhc1Blcm1pc3Npb24iLCJzb21lIiwiZ3JvdXAiLCJpbmNsdWRlcyIsImxvZ2dlciIsImluZm8iLCJyZW1vdGUiLCJFcnJvckNvZGUiLCJnZXRGb3JiaWRkZW4iLCJnZXRVbmF1dGhvcml6ZWQiLCJoYW5kbGVTcGVjaWFsVW5wdWJsaXNoIiwiaXNVbnB1Ymxpc2hNaXNzaW5nIiwiXyIsImlzTmlsIiwiaGFzR3JvdXBzIiwiZ2V0RGVmYXVsdFBsdWdpbnMiLCJhdXRoZW50aWNhdGUiLCJfdXNlciIsIl9wYXNzd29yZCIsImNiIiwiQVBJX0VSUk9SIiwiQkFEX1VTRVJOQU1FX1BBU1NXT1JEIiwiYWRkX3VzZXIiLCJnZXRDb25mbGljdCIsImFsbG93X2FjY2VzcyIsImFsbG93X3B1Ymxpc2giLCJhbGxvd191bnB1Ymxpc2giLCJkZWZhdWx0V2ViVG9rZW5PcHRpb25zIiwic2lnbiIsImV4cGlyZXNJbiIsIlRJTUVfRVhQSVJBVElPTl8xSCIsInZlcmlmeSIsImRlZmF1bHRBcGlUb2tlbkNvbmYiLCJsZWdhY3kiLCJkZWZhdWx0VXNlclJhdGVMaW1pdGluZyIsIndpbmRvd01zIiwibWF4IiwiZGVmYXVsdFNlY3VyaXR5Iiwid2ViIiwiYXBpIiwiZ2V0U2VjdXJpdHkiLCJjb25maWciLCJzZWN1cml0eSIsIm1lcmdlIiwiaXNBRVNMZWdhY3kiLCJqd3QiLCJnZXRBcGlUb2tlbiIsImF1dGgiLCJyZW1vdGVVc2VyIiwiYWVzUGFzc3dvcmQiLCJQcm9taXNlIiwicmVzb2x2ZSIsImFlc0VuY3J5cHQiLCJidWlsZFVzZXJCdWZmZXIiLCJ0b1N0cmluZyIsImp3dEVuY3J5cHQiLCJwYXJzZUF1dGhUb2tlbkhlYWRlciIsImF1dGhvcml6YXRpb25IZWFkZXIiLCJwYXJ0cyIsInNwbGl0Iiwic2NoZW1lIiwidG9rZW4iLCJwYXJzZUJhc2ljUGF5bG9hZCIsImNyZWRlbnRpYWxzIiwiaW5kZXgiLCJpbmRleE9mIiwic2xpY2UiLCJwYXJzZUFFU0NyZWRlbnRpYWxzIiwic2VjcmV0IiwidG9VcHBlckNhc2UiLCJUT0tFTl9CQVNJQyIsImNvbnZlcnRQYXlsb2FkVG9CYXNlNjQiLCJUT0tFTl9CRUFSRVIiLCJ0b2tlbkFzQnVmZmVyIiwiYWVzRGVjcnlwdCIsImV4cGlyZVJlYXNvbnMiLCJ2ZXJpZnlKV1RQYXlsb2FkIiwicGF5bG9hZCIsInZlcmlmeVBheWxvYWQiLCJlcnJvciIsImdldENvZGUiLCJIVFRQX1NUQVRVUyIsIlVOQVVUSE9SSVpFRCIsIm1lc3NhZ2UiLCJpc0F1dGhIZWFkZXJWYWxpZCIsImF1dGhvcml6YXRpb24iLCJnZXRNaWRkbGV3YXJlQ3JlZGVudGlhbHMiLCJwYXJzZWRDcmVkZW50aWFscyIsImlzU3RyaW5nIl0sInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9hdXRoLXV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBidWlsZERlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7XG4gIEFQSVRva2VuT3B0aW9ucyxcbiAgQ2FsbGJhY2ssXG4gIENvbmZpZyxcbiAgSVBsdWdpbkF1dGgsXG4gIEpXVE9wdGlvbnMsXG4gIFBhY2thZ2UsXG4gIFJlbW90ZVVzZXIsXG4gIFNlY3VyaXR5LFxufSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IGJ1aWxkVXNlckJ1ZmZlciB9IGZyb20gJ0B2ZXJkYWNjaW8vdXRpbHMnO1xuXG5pbXBvcnQge1xuICBBdXRoTWlkZGxld2FyZVBheWxvYWQsXG4gIEF1dGhUb2tlbkhlYWRlcixcbiAgQmFzaWNQYXlsb2FkLFxuICBDb29raWVTZXNzaW9uVG9rZW4sXG4gIElBdXRoV2ViVUksXG59IGZyb20gJy4uL3R5cGVzJztcbmltcG9ydCB7XG4gIEFQSV9FUlJPUixcbiAgREVGQVVMVF9NSU5fTElNSVRfUEFTU1dPUkQsXG4gIEhUVFBfU1RBVFVTLFxuICBST0xFUyxcbiAgVElNRV9FWFBJUkFUSU9OXzFILFxuICBUT0tFTl9CQVNJQyxcbiAgVE9LRU5fQkVBUkVSLFxufSBmcm9tICcuL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBhZXNEZWNyeXB0LCB2ZXJpZnlQYXlsb2FkIH0gZnJvbSAnLi9jcnlwdG8tdXRpbHMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgRXJyb3JDb2RlLCBjb252ZXJ0UGF5bG9hZFRvQmFzZTY0IH0gZnJvbSAnLi91dGlscyc7XG5cbmNvbnN0IGRlYnVnID0gYnVpbGREZWJ1ZygndmVyZGFjY2lvJyk7XG5cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhc3N3b3JkKFxuICBwYXNzd29yZDogc3RyaW5nLCAvLyBwcmFnbWE6IGFsbG93bGlzdCBzZWNyZXRcbiAgbWluTGVuZ3RoOiBudW1iZXIgPSBERUZBVUxUX01JTl9MSU1JVF9QQVNTV09SRFxuKTogYm9vbGVhbiB7XG4gIHJldHVybiB0eXBlb2YgcGFzc3dvcmQgPT09ICdzdHJpbmcnICYmIHBhc3N3b3JkLmxlbmd0aCA+PSBtaW5MZW5ndGg7XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgUmVtb3RlVXNlciBvYmplY3RcbiAqIEByZXR1cm4ge09iamVjdH0geyBuYW1lOiB4eCwgcGx1Z2luR3JvdXBzOiBbXSwgcmVhbF9ncm91cHM6IFtdIH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVJlbW90ZVVzZXIobmFtZTogc3RyaW5nLCBwbHVnaW5Hcm91cHM6IHN0cmluZ1tdKTogUmVtb3RlVXNlciB7XG4gIGNvbnN0IGlzR3JvdXBWYWxpZDogYm9vbGVhbiA9IEFycmF5LmlzQXJyYXkocGx1Z2luR3JvdXBzKTtcbiAgY29uc3QgZ3JvdXBzID0gQXJyYXkuZnJvbShcbiAgICBuZXcgU2V0KFxuICAgICAgKGlzR3JvdXBWYWxpZCA/IHBsdWdpbkdyb3VwcyA6IFtdKS5jb25jYXQoW1xuICAgICAgICBST0xFUy4kQUxMLFxuICAgICAgICBST0xFUy4kQVVUSCxcbiAgICAgICAgUk9MRVMuREVQUkVDQVRFRF9BTEwsXG4gICAgICAgIFJPTEVTLkRFUFJFQ0FURURfQVVUSCxcbiAgICAgICAgUk9MRVMuQUxMLFxuICAgICAgXSlcbiAgICApXG4gICk7XG5cbiAgcmV0dXJuIHtcbiAgICBuYW1lLFxuICAgIGdyb3VwcyxcbiAgICByZWFsX2dyb3VwczogcGx1Z2luR3JvdXBzLFxuICB9O1xufVxuXG4vKipcbiAqIEJ1aWxkcyBhbiBhbm9ueW1vdXMgcmVtb3RlIHVzZXIgaW4gY2FzZSBub25lIGlzIGxvZ2dlZCBpbi5cbiAqIEByZXR1cm4ge09iamVjdH0geyBuYW1lOiB4eCwgZ3JvdXBzOiBbXSwgcmVhbF9ncm91cHM6IFtdIH1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUFub255bW91c1JlbW90ZVVzZXIoKTogUmVtb3RlVXNlciB7XG4gIHJldHVybiB7XG4gICAgbmFtZTogdW5kZWZpbmVkLFxuICAgIC8vIGdyb3VwcyB3aXRob3V0ICckJyBhcmUgZ29pbmcgdG8gYmUgZGVwcmVjYXRlZCBldmVudHVhbGx5XG4gICAgZ3JvdXBzOiBbUk9MRVMuJEFMTCwgUk9MRVMuJEFOT05ZTU9VUywgUk9MRVMuREVQUkVDQVRFRF9BTEwsIFJPTEVTLkRFUFJFQ0FURURfQU5PTllNT1VTXSxcbiAgICByZWFsX2dyb3VwczogW10sXG4gIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhbGxvd19hY3Rpb24oYWN0aW9uOiBzdHJpbmcpOiBGdW5jdGlvbiB7XG4gIHJldHVybiBmdW5jdGlvbiAodXNlcjogUmVtb3RlVXNlciwgcGtnOiBQYWNrYWdlLCBjYWxsYmFjazogQ2FsbGJhY2spOiB2b2lkIHtcbiAgICBkZWJ1ZygnW2F1dGgvYWxsb3dfYWN0aW9uXTogdXNlcjogJW8nLCB1c2VyPy5uYW1lKTtcbiAgICBjb25zdCB7IG5hbWUsIGdyb3VwcyB9ID0gdXNlcjtcbiAgICBjb25zdCBncm91cEFjY2VzcyA9IHBrZ1thY3Rpb25dO1xuICAgIGNvbnN0IGhhc1Blcm1pc3Npb24gPSBncm91cEFjY2Vzcy5zb21lKChncm91cCkgPT4gbmFtZSA9PT0gZ3JvdXAgfHwgZ3JvdXBzLmluY2x1ZGVzKGdyb3VwKSk7XG4gICAgZGVidWcoJ1thdXRoL2FsbG93X2FjdGlvbl06IGhhc1Blcm1pc3Npb24/ICVvfSBmb3IgdXNlcjogJW8nLCBoYXNQZXJtaXNzaW9uLCB1c2VyPy5uYW1lKTtcblxuICAgIGlmIChoYXNQZXJtaXNzaW9uKSB7XG4gICAgICBsb2dnZXIuaW5mbyh7IHJlbW90ZTogdXNlci5uYW1lIH0sIGBhdXRoL2FsbG93X2FjdGlvbjogYWNjZXNzIGdyYW50ZWQgdG86IEB7dXNlcn1gKTtcbiAgICAgIHJldHVybiBjYWxsYmFjayhudWxsLCB0cnVlKTtcbiAgICB9XG5cbiAgICBpZiAobmFtZSkge1xuICAgICAgY2FsbGJhY2soXG4gICAgICAgIEVycm9yQ29kZS5nZXRGb3JiaWRkZW4oYHVzZXIgJHtuYW1lfSBpcyBub3QgYWxsb3dlZCB0byAke2FjdGlvbn0gcGFja2FnZSAke3BrZy5uYW1lfWApXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjYWxsYmFjayhcbiAgICAgICAgRXJyb3JDb2RlLmdldFVuYXV0aG9yaXplZChgYXV0aG9yaXphdGlvbiByZXF1aXJlZCB0byAke2FjdGlvbn0gcGFja2FnZSAke3BrZy5uYW1lfWApXG4gICAgICApO1xuICAgIH1cbiAgfTtcbn1cblxuLyoqXG4gKlxuICovXG5leHBvcnQgZnVuY3Rpb24gaGFuZGxlU3BlY2lhbFVucHVibGlzaCgpOiBhbnkge1xuICByZXR1cm4gZnVuY3Rpb24gKHVzZXI6IFJlbW90ZVVzZXIsIHBrZzogUGFja2FnZSwgY2FsbGJhY2s6IENhbGxiYWNrKTogdm9pZCB7XG4gICAgY29uc3QgYWN0aW9uID0gJ3VucHVibGlzaCc7XG4gICAgLy8gdmVyaWZ5IHdoZXRoZXIgdGhlIHVucHVibGlzaCBwcm9wIGhhcyBiZWVuIGRlZmluZWRcbiAgICBjb25zdCBpc1VucHVibGlzaE1pc3Npbmc6IGJvb2xlYW4gPSBfLmlzTmlsKHBrZ1thY3Rpb25dKTtcbiAgICBjb25zdCBoYXNHcm91cHM6IGJvb2xlYW4gPSBpc1VucHVibGlzaE1pc3NpbmcgPyBmYWxzZSA6IHBrZ1thY3Rpb25dLmxlbmd0aCA+IDA7XG4gICAgZGVidWcoJ2ZhbGxiYWNrIHVucHVibGlzaCBmb3IgQHtuYW1lfSBoYXMgZ3JvdXBzOiAlbyBmb3IgJW8nLCBoYXNHcm91cHMsIHVzZXI/Lm5hbWUpO1xuICAgIGlmIChpc1VucHVibGlzaE1pc3NpbmcgfHwgaGFzR3JvdXBzID09PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGNhbGxiYWNrKG51bGwsIHVuZGVmaW5lZCk7XG4gICAgfVxuICAgIGRlYnVnKCdhbGxvd19hY3Rpb24gZm9yICVvIGZvciAlbyBoYXMgZ3JvdXBzOiAlbyBmb3IgJW8nLCBhY3Rpb24sIHVzZXI/Lm5hbWUsIGhhc0dyb3VwcywgdXNlcik7XG4gICAgcmV0dXJuIGFsbG93X2FjdGlvbihhY3Rpb24pKHVzZXIsIHBrZywgY2FsbGJhY2spO1xuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGVmYXVsdFBsdWdpbnMobG9nZ2VyOiBhbnkpOiBJUGx1Z2luQXV0aDxDb25maWc+IHtcbiAgcmV0dXJuIHtcbiAgICBhdXRoZW50aWNhdGUoX3VzZXI6IHN0cmluZywgX3Bhc3N3b3JkOiBzdHJpbmcsIGNiOiBDYWxsYmFjayk6IHZvaWQge1xuICAgICAgLy8gcHJhZ21hOiBhbGxvd2xpc3Qgc2VjcmV0XG4gICAgICBjYihFcnJvckNvZGUuZ2V0Rm9yYmlkZGVuKEFQSV9FUlJPUi5CQURfVVNFUk5BTUVfUEFTU1dPUkQpKTtcbiAgICB9LFxuXG4gICAgYWRkX3VzZXIoX3VzZXI6IHN0cmluZywgX3Bhc3N3b3JkOiBzdHJpbmcsIGNiOiBDYWxsYmFjayk6IHZvaWQge1xuICAgICAgLy8gcHJhZ21hOiBhbGxvd2xpc3Qgc2VjcmV0XG4gICAgICByZXR1cm4gY2IoRXJyb3JDb2RlLmdldENvbmZsaWN0KEFQSV9FUlJPUi5CQURfVVNFUk5BTUVfUEFTU1dPUkQpKTtcbiAgICB9LFxuXG4gICAgLy8gRklYTUU6IGFsbG93X2FjdGlvbiBhbmQgYWxsb3dfcHVibGlzaCBzaG91bGQgYmUgaW4gdGhlIEB2ZXJkYWNjaW8vdHlwZXNcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgYWxsb3dfYWNjZXNzOiBhbGxvd19hY3Rpb24oJ2FjY2VzcycsIGxvZ2dlciksXG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIGFsbG93X3B1Ymxpc2g6IGFsbG93X2FjdGlvbigncHVibGlzaCcsIGxvZ2dlciksXG4gICAgYWxsb3dfdW5wdWJsaXNoOiBoYW5kbGVTcGVjaWFsVW5wdWJsaXNoKCksXG4gIH07XG59XG5cbmNvbnN0IGRlZmF1bHRXZWJUb2tlbk9wdGlvbnM6IEpXVE9wdGlvbnMgPSB7XG4gIHNpZ246IHtcbiAgICAvLyBUaGUgZXhwaXJhdGlvbiB0b2tlbiBmb3IgdGhlIHdlYnNpdGUgaXMgMSBob3VyXG4gICAgZXhwaXJlc0luOiBUSU1FX0VYUElSQVRJT05fMUgsXG4gIH0sXG4gIHZlcmlmeToge30sXG59O1xuXG5jb25zdCBkZWZhdWx0QXBpVG9rZW5Db25mOiBBUElUb2tlbk9wdGlvbnMgPSB7XG4gIGxlZ2FjeTogdHJ1ZSxcbn07XG5cbi8vIHdlIGxpbWl0IG1heCAxMDAwIHJlcXVlc3QgcGVyIDE1IG1pbnV0ZXMgb24gdXNlciBlbmRwb2ludHNcbmV4cG9ydCBjb25zdCBkZWZhdWx0VXNlclJhdGVMaW1pdGluZyA9IHtcbiAgd2luZG93TXM6IDE1ICogNjAgKiAxMDAwLCAvLyAxNSBtaW51dGVzXG4gIG1heDogMTAwMCxcbn07XG5cbmV4cG9ydCBjb25zdCBkZWZhdWx0U2VjdXJpdHk6IFNlY3VyaXR5ID0ge1xuICB3ZWI6IGRlZmF1bHRXZWJUb2tlbk9wdGlvbnMsXG4gIGFwaTogZGVmYXVsdEFwaVRva2VuQ29uZixcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXRTZWN1cml0eShjb25maWc6IENvbmZpZyk6IFNlY3VyaXR5IHtcbiAgaWYgKF8uaXNOaWwoY29uZmlnLnNlY3VyaXR5KSA9PT0gZmFsc2UpIHtcbiAgICByZXR1cm4gXy5tZXJnZShkZWZhdWx0U2VjdXJpdHksIGNvbmZpZy5zZWN1cml0eSk7XG4gIH1cblxuICByZXR1cm4gZGVmYXVsdFNlY3VyaXR5O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNBRVNMZWdhY3koc2VjdXJpdHk6IFNlY3VyaXR5KTogYm9vbGVhbiB7XG4gIGNvbnN0IHsgbGVnYWN5LCBqd3QgfSA9IHNlY3VyaXR5LmFwaTtcblxuICByZXR1cm4gXy5pc05pbChsZWdhY3kpID09PSBmYWxzZSAmJiBfLmlzTmlsKGp3dCkgJiYgbGVnYWN5ID09PSB0cnVlO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QXBpVG9rZW4oXG4gIGF1dGg6IElBdXRoV2ViVUksXG4gIGNvbmZpZzogQ29uZmlnLFxuICByZW1vdGVVc2VyOiBSZW1vdGVVc2VyLFxuICBhZXNQYXNzd29yZDogc3RyaW5nXG4pOiBQcm9taXNlPHN0cmluZz4ge1xuICBjb25zdCBzZWN1cml0eTogU2VjdXJpdHkgPSBnZXRTZWN1cml0eShjb25maWcpO1xuICBpZiAoaXNBRVNMZWdhY3koc2VjdXJpdHkpKSB7XG4gICAgLy8gZmFsbGJhY2sgYWxsIGdvZXMgdG8gQUVTIGVuY3J5cHRpb25cbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUpOiB2b2lkID0+IHtcbiAgICAgIHJlc29sdmUoXG4gICAgICAgIGF1dGguYWVzRW5jcnlwdChidWlsZFVzZXJCdWZmZXIocmVtb3RlVXNlci5uYW1lIGFzIHN0cmluZywgYWVzUGFzc3dvcmQpKS50b1N0cmluZygnYmFzZTY0JylcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cbiAgLy8gaSBhbSB3aWxpbmcgdG8gdXNlIGhlcmUgXy5pc05pbCBidXQgZmxvdyBkb2VzIG5vdCBsaWtlIGl0IHlldC5cbiAgY29uc3QgeyBqd3QgfSA9IHNlY3VyaXR5LmFwaTtcblxuICBpZiAoand0ICYmIGp3dC5zaWduKSB7XG4gICAgcmV0dXJuIGF3YWl0IGF1dGguand0RW5jcnlwdChyZW1vdGVVc2VyLCBqd3Quc2lnbik7XG4gIH1cbiAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKTogdm9pZCA9PiB7XG4gICAgcmVzb2x2ZShcbiAgICAgIGF1dGguYWVzRW5jcnlwdChidWlsZFVzZXJCdWZmZXIocmVtb3RlVXNlci5uYW1lIGFzIHN0cmluZywgYWVzUGFzc3dvcmQpKS50b1N0cmluZygnYmFzZTY0JylcbiAgICApO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlQXV0aFRva2VuSGVhZGVyKGF1dGhvcml6YXRpb25IZWFkZXI6IHN0cmluZyk6IEF1dGhUb2tlbkhlYWRlciB7XG4gIGNvbnN0IHBhcnRzID0gYXV0aG9yaXphdGlvbkhlYWRlci5zcGxpdCgnICcpO1xuICBjb25zdCBbc2NoZW1lLCB0b2tlbl0gPSBwYXJ0cztcblxuICByZXR1cm4geyBzY2hlbWUsIHRva2VuIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUJhc2ljUGF5bG9hZChjcmVkZW50aWFsczogc3RyaW5nKTogQmFzaWNQYXlsb2FkIHtcbiAgY29uc3QgaW5kZXggPSBjcmVkZW50aWFscy5pbmRleE9mKCc6Jyk7XG4gIGlmIChpbmRleCA8IDApIHtcbiAgICByZXR1cm47XG4gIH1cblxuICBjb25zdCB1c2VyOiBzdHJpbmcgPSBjcmVkZW50aWFscy5zbGljZSgwLCBpbmRleCk7XG4gIGNvbnN0IHBhc3N3b3JkOiBzdHJpbmcgPSBjcmVkZW50aWFscy5zbGljZShpbmRleCArIDEpO1xuXG4gIHJldHVybiB7IHVzZXIsIHBhc3N3b3JkIH07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZUFFU0NyZWRlbnRpYWxzKGF1dGhvcml6YXRpb25IZWFkZXI6IHN0cmluZywgc2VjcmV0OiBzdHJpbmcpIHtcbiAgY29uc3QgeyBzY2hlbWUsIHRva2VuIH0gPSBwYXJzZUF1dGhUb2tlbkhlYWRlcihhdXRob3JpemF0aW9uSGVhZGVyKTtcblxuICAvLyBiYXNpYyBpcyBkZXByZWNhdGVkIGFuZCBzaG91bGQgbm90IGJlIGVuZm9yY2VkXG4gIGlmIChzY2hlbWUudG9VcHBlckNhc2UoKSA9PT0gVE9LRU5fQkFTSUMudG9VcHBlckNhc2UoKSkge1xuICAgIGNvbnN0IGNyZWRlbnRpYWxzID0gY29udmVydFBheWxvYWRUb0Jhc2U2NCh0b2tlbikudG9TdHJpbmcoKTtcblxuICAgIHJldHVybiBjcmVkZW50aWFscztcbiAgfSBlbHNlIGlmIChzY2hlbWUudG9VcHBlckNhc2UoKSA9PT0gVE9LRU5fQkVBUkVSLnRvVXBwZXJDYXNlKCkpIHtcbiAgICBjb25zdCB0b2tlbkFzQnVmZmVyID0gY29udmVydFBheWxvYWRUb0Jhc2U2NCh0b2tlbik7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBhZXNEZWNyeXB0KHRva2VuQXNCdWZmZXIsIHNlY3JldCkudG9TdHJpbmcoJ3V0ZjgnKTtcblxuICAgIHJldHVybiBjcmVkZW50aWFscztcbiAgfVxufVxuXG5leHBvcnQgY29uc3QgZXhwaXJlUmVhc29uczogc3RyaW5nW10gPSBbJ0pzb25XZWJUb2tlbkVycm9yJywgJ1Rva2VuRXhwaXJlZEVycm9yJ107XG5cbmV4cG9ydCBmdW5jdGlvbiB2ZXJpZnlKV1RQYXlsb2FkKHRva2VuOiBzdHJpbmcsIHNlY3JldDogc3RyaW5nKTogUmVtb3RlVXNlciB7XG4gIHRyeSB7XG4gICAgY29uc3QgcGF5bG9hZDogUmVtb3RlVXNlciA9IHZlcmlmeVBheWxvYWQodG9rZW4sIHNlY3JldCk7XG5cbiAgICByZXR1cm4gcGF5bG9hZDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAvLyAjMTY4IHRoaXMgY2hlY2sgc2hvdWxkIGJlIHJlbW92ZWQgYXMgc29vbiBBRVMgZW5jcnlwdCBpcyByZW1vdmVkLlxuICAgIGlmIChleHBpcmVSZWFzb25zLmluY2x1ZGVzKGVycm9yLm5hbWUpKSB7XG4gICAgICAvLyBpdCBtaWdodCBiZSBwb3NzaWJsZSB0aGUgand0IGNvbmZpZ3VyYXRpb24gaXMgZW5hYmxlZCBhbmRcbiAgICAgIC8vIG9sZCB0b2tlbnMgZmFpbHMgc3RpbGwgcmVtYWlucyBpbiB1c2FnZSwgdGh1c1xuICAgICAgLy8gd2UgcmV0dXJuIGFuIGFub255bW91cyB1c2VyIHRvIGZvcmNlIGxvZyBpbi5cbiAgICAgIHJldHVybiBjcmVhdGVBbm9ueW1vdXNSZW1vdGVVc2VyKCk7XG4gICAgfVxuICAgIHRocm93IEVycm9yQ29kZS5nZXRDb2RlKEhUVFBfU1RBVFVTLlVOQVVUSE9SSVpFRCwgZXJyb3IubWVzc2FnZSk7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGlzQXV0aEhlYWRlclZhbGlkKGF1dGhvcml6YXRpb246IHN0cmluZyk6IGJvb2xlYW4ge1xuICByZXR1cm4gYXV0aG9yaXphdGlvbi5zcGxpdCgnICcpLmxlbmd0aCA9PT0gMjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldE1pZGRsZXdhcmVDcmVkZW50aWFscyhcbiAgc2VjdXJpdHk6IFNlY3VyaXR5LFxuICBzZWNyZXQ6IHN0cmluZyxcbiAgYXV0aG9yaXphdGlvbkhlYWRlcjogc3RyaW5nXG4pOiBBdXRoTWlkZGxld2FyZVBheWxvYWQge1xuICBpZiAoaXNBRVNMZWdhY3koc2VjdXJpdHkpKSB7XG4gICAgY29uc3QgY3JlZGVudGlhbHMgPSBwYXJzZUFFU0NyZWRlbnRpYWxzKGF1dGhvcml6YXRpb25IZWFkZXIsIHNlY3JldCk7XG4gICAgaWYgKCFjcmVkZW50aWFscykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHBhcnNlZENyZWRlbnRpYWxzID0gcGFyc2VCYXNpY1BheWxvYWQoY3JlZGVudGlhbHMpO1xuICAgIGlmICghcGFyc2VkQ3JlZGVudGlhbHMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICByZXR1cm4gcGFyc2VkQ3JlZGVudGlhbHM7XG4gIH1cbiAgY29uc3QgeyBzY2hlbWUsIHRva2VuIH0gPSBwYXJzZUF1dGhUb2tlbkhlYWRlcihhdXRob3JpemF0aW9uSGVhZGVyKTtcblxuICBpZiAoXy5pc1N0cmluZyh0b2tlbikgJiYgc2NoZW1lLnRvVXBwZXJDYXNlKCkgPT09IFRPS0VOX0JFQVJFUi50b1VwcGVyQ2FzZSgpKSB7XG4gICAgcmV0dXJuIHZlcmlmeUpXVFBheWxvYWQodG9rZW4sIHNlY3JldCk7XG4gIH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQVlBO0FBU0E7QUFTQTtBQUNBO0FBQ0E7QUFBNEQ7QUFFNUQsTUFBTUEsS0FBSyxHQUFHLElBQUFDLGNBQVUsRUFBQyxXQUFXLENBQUM7QUFFOUIsU0FBU0MsZ0JBQWdCLENBQzlCQyxRQUFnQjtBQUFFO0FBQ2xCQyxTQUFpQixHQUFHQyxxQ0FBMEIsRUFDckM7RUFDVCxPQUFPLE9BQU9GLFFBQVEsS0FBSyxRQUFRLElBQUlBLFFBQVEsQ0FBQ0csTUFBTSxJQUFJRixTQUFTO0FBQ3JFOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ08sU0FBU0csZ0JBQWdCLENBQUNDLElBQVksRUFBRUMsWUFBc0IsRUFBYztFQUNqRixNQUFNQyxZQUFxQixH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